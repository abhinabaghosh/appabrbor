var SchemaObject = require('../node-schema-object/lib/schemaobject')
  , _ = require('underscore');

var Data = new SchemaObject({
}, {
  strict: false
  , toObject: function(object) {
    var out = {};
    _.each(object, function(value, key) {
      if(key.indexOf('[]') !== -1) {
        key = key.substring(0, key.length - 2);
        value = _.toArray(value);
      }
      out[key] = value;
    });
    return out;
  }
});

var User = new SchemaObject({
  data: Data
}, {
  dotNotation: true,
  strict: true
});

var user = new User();
user['data.persona[].0.name'] = 'Jay';
user['data.persona[].0.id'] = 2;
user['data.persona[].1.name'] = 'Scott';
user['data.persona[].1.id'] = 1;

console.log(user.toObject().data);

// Outputs: